<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æŠ½é¸ã‚¢ãƒ—ãƒª</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', 'Hiragino Sans', 'Meiryo', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        h1 {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .loading {
            text-align: center;
            color: white;
            font-size: 1.5em;
            padding: 50px;
        }

        .setup-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .setup-section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.5em;
        }

        .input-group {
            margin-bottom: 20px;
        }

        .input-group label {
            display: block;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .input-group textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            font-family: inherit;
            resize: vertical;
        }

        .input-group textarea:focus {
            outline: none;
            border-color: #667eea;
        }

        .hint {
            font-size: 12px;
            color: #666;
            margin-top: 5px;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 4px solid #2196f3;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 5px;
        }

        .info-box h3 {
            color: #1976d2;
            margin-bottom: 10px;
            font-size: 1.1em;
        }

        .info-box p {
            color: #555;
            font-size: 14px;
            line-height: 1.6;
            margin-bottom: 8px;
        }

        .info-box code {
            background: white;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            color: #d32f2f;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-bottom: 20px;
        }

        .export-button {
            padding: 12px;
            background: #2ecc71;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .export-button:hover {
            background: #27ae60;
            transform: translateY(-2px);
        }

        .reload-button {
            padding: 12px;
            background: #f39c12;
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .reload-button:hover {
            background: #e67e22;
            transform: translateY(-2px);
        }

        .start-button {
            width: 100%;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .start-button:hover {
            transform: translateY(-2px);
        }

        .start-button:active {
            transform: translateY(0);
        }

        .lottery-section {
            display: none;
        }

        .lottery-section.active {
            display: block;
        }

        .main-content {
            display: grid;
            grid-template-columns: 2fr 1fr;
            gap: 30px;
            margin-bottom: 30px;
        }

        .pots-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }

        .pot-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            text-align: center;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .pot-card.pot1 {
            border-top: 5px solid #e74c3c;
        }

        .pot-card.pot2 {
            border-top: 5px solid #3498db;
        }

        .pot-card.pot3 {
            border-top: 5px solid #2ecc71;
        }

        .pot-title {
            font-size: 1.3em;
            font-weight: bold;
            margin-bottom: 15px;
        }

        .pot-card.pot1 .pot-title {
            color: #e74c3c;
        }

        .pot-card.pot2 .pot-title {
            color: #3498db;
        }

        .pot-card.pot3 .pot-title {
            color: #2ecc71;
        }

        .pot-image {
            width: 120px;
            height: 120px;
            margin: 15px auto;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 50px;
        }

        .pot-card.pot1 .pot-image {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            box-shadow: 0 5px 15px rgba(231, 76, 60, 0.4);
        }

        .pot-card.pot2 .pot-image {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
        }

        .pot-card.pot3 .pot-image {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
            box-shadow: 0 5px 15px rgba(46, 204, 113, 0.4);
        }

        .remaining-count {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
        }

        .result-display {
            min-height: 50px;
            background: #f8f9fa;
            border-radius: 10px;
            padding: 12px;
            margin: 15px 0;
            font-size: 20px;
            font-weight: bold;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px dashed #ddd;
        }

        .result-display.has-result {
            background: linear-gradient(135deg, #ffeaa7 0%, #fdcb6e 100%);
            border: 2px solid #fdcb6e;
            animation: popIn 0.5s ease-out;
        }

        @keyframes popIn {
            0% {
                transform: scale(0.8);
                opacity: 0;
            }
            50% {
                transform: scale(1.05);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .draw-button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .draw-button:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .draw-button:active:not(:disabled) {
            transform: translateY(0);
        }

        .draw-button:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            opacity: 0.6;
        }

        /* ãƒãƒ¼ãƒ ç·¨æˆã‚¨ãƒªã‚¢ */
        .teams-area {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .teams-area h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.3em;
            text-align: center;
        }

        .team-card {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            min-height: 100px;
        }

        .team-card.team1 {
            border-left: 5px solid #e74c3c;
        }

        .team-card.team2 {
            border-left: 5px solid #3498db;
        }

        .team-card.team3 {
            border-left: 5px solid #2ecc71;
        }

        .team-header {
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .team-card.team1 .team-header {
            color: #e74c3c;
        }

        .team-card.team2 .team-header {
            color: #3498db;
        }

        .team-card.team3 .team-header {
            color: #2ecc71;
        }

        .team-count {
            font-size: 0.9em;
            color: #666;
        }

        .team-members {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .team-member {
            background: white;
            padding: 10px 15px;
            border-radius: 5px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            animation: slideInMember 0.3s ease-out;
        }

        @keyframes slideInMember {
            from {
                transform: translateX(-20px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .member-name {
            font-weight: 500;
            color: #333;
        }

        .member-order {
            font-size: 0.85em;
            color: #999;
            background: #f0f0f0;
            padding: 3px 8px;
            border-radius: 3px;
        }

        .team-empty {
            text-align: center;
            color: #999;
            font-size: 14px;
            padding: 20px;
        }

        .reset-button {
            display: block;
            margin: 30px auto;
            padding: 15px 40px;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }

        .reset-button:hover {
            background: #c0392b;
            transform: translateY(-2px);
        }

        .history-section {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .history-section h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .history-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .history-item:last-child {
            border-bottom: none;
        }

        .history-pot {
            font-weight: bold;
            padding: 5px 10px;
            border-radius: 5px;
            color: white;
        }

        .history-pot.pot1 {
            background: #e74c3c;
        }

        .history-pot.pot2 {
            background: #3498db;
        }

        .history-pot.pot3 {
            background: #2ecc71;
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.3);
            z-index: 1000;
            animation: slideIn 0.3s ease-out;
            display: none;
        }

        .notification.show {
            display: block;
        }

        .notification.success {
            border-left: 5px solid #2ecc71;
        }

        .notification.error {
            border-left: 5px solid #e74c3c;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
            }

            .pots-container {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }

            .button-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ¯ æŠ½é¸ã‚¢ãƒ—ãƒª</h1>

        <!-- ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚° -->
        <div class="loading" id="loading">
            ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§ã„ã¾ã™...
        </div>

        <!-- è¨­å®šã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="setup-section" id="setupSection" style="display: none;">
            <h2>äººç‰©åã®ç™»éŒ²</h2>
            
            <!-- GitHubä½¿ç”¨æ–¹æ³•ã®èª¬æ˜ -->
            <div class="info-box">
                <h3>ğŸ“– GitHubé€£æºã®ä½¿ã„æ–¹</h3>
                <p><strong>PCã§ã®ç·¨é›†:</strong></p>
                <p>1. ä¸‹è¨˜ã®ãƒ•ã‚©ãƒ¼ãƒ ã§äººç‰©åã‚’ç·¨é›†</p>
                <p>2. ã€Œdata.jsonã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã€ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯</p>
                <p>3. ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ãŸ<code>data.json</code>ã‚’GitHubãƒªãƒã‚¸ãƒˆãƒªã«ãƒ—ãƒƒã‚·ãƒ¥</p>
                <p><strong>ã‚¹ãƒãƒ›ã§ã®ä½¿ç”¨:</strong></p>
                <p>1. GitHub Pagesã®URLã«ã‚¢ã‚¯ã‚»ã‚¹</p>
                <p>2. è‡ªå‹•çš„ã«æœ€æ–°ã®data.jsonãŒèª­ã¿è¾¼ã¾ã‚Œã¾ã™</p>
                <p>3. ãã®ã¾ã¾ã€ŒæŠ½é¸ã‚’é–‹å§‹ã€ã‚’ã‚¿ãƒƒãƒ—</p>
            </div>

            <div class="button-group">
                <button class="export-button" onclick="exportDataJson()">ğŸ“¥ data.json ã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰</button>
                <button class="reload-button" onclick="reloadData()">ğŸ”„ data.json ã‚’å†èª­ã¿è¾¼ã¿</button>
            </div>

            <div class="input-group">
                <label for="pot1Input">POT 1 (èµ¤)</label>
                <textarea id="pot1Input" placeholder="äººç‰©åã‚’1è¡Œã«1åãšã¤å…¥åŠ›ã—ã¦ãã ã•ã„&#10;ä¾‹:&#10;å±±ç”°å¤ªéƒ&#10;éˆ´æœ¨èŠ±å­&#10;ä½è—¤æ¬¡éƒ"></textarea>
                <div class="hint">1è¡Œã«1åãšã¤å…¥åŠ›ã—ã¦ãã ã•ã„</div>
            </div>

            <div class="input-group">
                <label for="pot2Input">POT 2 (é’)</label>
                <textarea id="pot2Input" placeholder="äººç‰©åã‚’1è¡Œã«1åãšã¤å…¥åŠ›ã—ã¦ãã ã•ã„&#10;ä¾‹:&#10;ç”°ä¸­ä¸€éƒ&#10;é«˜æ©‹ç¾å’²&#10;ä¼Šè—¤å¥å¤ª"></textarea>
                <div class="hint">1è¡Œã«1åãšã¤å…¥åŠ›ã—ã¦ãã ã•ã„</div>
            </div>

            <div class="input-group">
                <label for="pot3Input">POT 3 (ç·‘)</label>
                <textarea id="pot3Input" placeholder="äººç‰©åã‚’1è¡Œã«1åãšã¤å…¥åŠ›ã—ã¦ãã ã•ã„&#10;ä¾‹:&#10;æ¸¡è¾ºã•ãã‚‰&#10;ä¸­æ‘å¤§è¼”&#10;å°æ—æ„›"></textarea>
                <div class="hint">1è¡Œã«1åãšã¤å…¥åŠ›ã—ã¦ãã ã•ã„</div>
            </div>

            <button class="start-button" onclick="startLottery()">æŠ½é¸ã‚’é–‹å§‹</button>
        </div>

        <!-- æŠ½é¸ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
        <div class="lottery-section" id="lotterySection">
            <div class="main-content">
                <!-- POTã‚¨ãƒªã‚¢ -->
                <div>
                    <div class="pots-container">
                        <!-- POT 1 -->
                        <div class="pot-card pot1">
                            <div class="pot-title">POT 1</div>
                            <div class="pot-image">ğŸº</div>
                            <div class="remaining-count" id="pot1Count">æ®‹ã‚Š: 0å</div>
                            <div class="result-display" id="pot1Result">çµæœè¡¨ç¤º</div>
                            <button class="draw-button" id="pot1Button" onclick="draw(1)">æŠ½é¸</button>
                        </div>

                        <!-- POT 2 -->
                        <div class="pot-card pot2">
                            <div class="pot-title">POT 2</div>
                            <div class="pot-image">ğŸº</div>
                            <div class="remaining-count" id="pot2Count">æ®‹ã‚Š: 0å</div>
                            <div class="result-display" id="pot2Result">çµæœè¡¨ç¤º</div>
                            <button class="draw-button" id="pot2Button" onclick="draw(2)">æŠ½é¸</button>
                        </div>

                        <!-- POT 3 -->
                        <div class="pot-card pot3">
                            <div class="pot-title">POT 3</div>
                            <div class="pot-image">ğŸº</div>
                            <div class="remaining-count" id="pot3Count">æ®‹ã‚Š: 0å</div>
                            <div class="result-display" id="pot3Result">çµæœè¡¨ç¤º</div>
                            <button class="draw-button" id="pot3Button" onclick="draw(3)">æŠ½é¸</button>
                        </div>
                    </div>
                </div>

                <!-- ãƒãƒ¼ãƒ ç·¨æˆã‚¨ãƒªã‚¢ -->
                <div class="teams-area">
                    <h2>ğŸ‘¥ ãƒãƒ¼ãƒ ç·¨æˆ</h2>
                    
                    <!-- ãƒãƒ¼ãƒ 1 -->
                    <div class="team-card team1">
                        <div class="team-header">
                            <span>ãƒãƒ¼ãƒ  1</span>
                            <span class="team-count" id="team1Count">0å</span>
                        </div>
                        <div class="team-members" id="team1Members">
                            <div class="team-empty">ã¾ã ãƒ¡ãƒ³ãƒãƒ¼ãŒã„ã¾ã›ã‚“</div>
                        </div>
                    </div>

                    <!-- ãƒãƒ¼ãƒ 2 -->
                    <div class="team-card team2">
                        <div class="team-header">
                            <span>ãƒãƒ¼ãƒ  2</span>
                            <span class="team-count" id="team2Count">0å</span>
                        </div>
                        <div class="team-members" id="team2Members">
                            <div class="team-empty">ã¾ã ãƒ¡ãƒ³ãƒãƒ¼ãŒã„ã¾ã›ã‚“</div>
                        </div>
                    </div>

                    <!-- ãƒãƒ¼ãƒ 3 -->
                    <div class="team-card team3">
                        <div class="team-header">
                            <span>ãƒãƒ¼ãƒ  3</span>
                            <span class="team-count" id="team3Count">0å</span>
                        </div>
                        <div class="team-members" id="team3Members">
                            <div class="team-empty">ã¾ã ãƒ¡ãƒ³ãƒãƒ¼ãŒã„ã¾ã›ã‚“</div>
                        </div>
                    </div>
                </div>
            </div>

            <button class="reset-button" onclick="resetLottery()">ãƒªã‚»ãƒƒãƒˆ</button>

            <!-- å±¥æ­´ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <div class="history-section">
                <h2>æŠ½é¸å±¥æ­´</h2>
                <div class="history-list" id="historyList">
                    <p style="text-align: center; color: #999;">ã¾ã æŠ½é¸ãŒè¡Œã‚ã‚Œã¦ã„ã¾ã›ã‚“</p>
                </div>
            </div>
        </div>
    </div>

    <!-- é€šçŸ¥ -->
    <div class="notification" id="notification"></div>

    <script>
        // ãƒ‡ãƒ¼ã‚¿ä¿å­˜ç”¨
        let potData = {
            1: [],
            2: [],
            3: []
        };

        let potIndex = {
            1: 0,
            2: 0,
            3: 0
        };

        let history = [];

        // ãƒãƒ¼ãƒ ç·¨æˆãƒ‡ãƒ¼ã‚¿
        let teams = {
            1: [],
            2: [],
            3: []
        };

        let drawOrder = 0; // å…¨ä½“ã®æŠ½é¸é †åº

        // é€šçŸ¥è¡¨ç¤º
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // åˆæœŸãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
        async function loadData() {
            try {
                // data.jsonã‚’èª­ã¿è¾¼ã¿(ã‚­ãƒ£ãƒƒã‚·ãƒ¥å›é¿ã®ãŸã‚ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’è¿½åŠ )
                const response = await fetch(`data.json?t=${Date.now()}`);
                
                if (!response.ok) {
                    throw new Error('data.jsonãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“');
                }
                
                const data = await response.json();
                
                // ãƒ‡ãƒ¼ã‚¿ã®æ¤œè¨¼
                if (!data.pots || !data.pots[1] || !data.pots[2] || !data.pots[3]) {
                    throw new Error('ç„¡åŠ¹ãªãƒ‡ãƒ¼ã‚¿å½¢å¼ã§ã™');
                }

                // ãƒ‡ãƒ¼ã‚¿ã‚’å…¥åŠ›æ¬„ã«åæ˜ 
                document.getElementById('pot1Input').value = data.pots[1].join('\n');
                document.getElementById('pot2Input').value = data.pots[2].join('\n');
                document.getElementById('pot3Input').value = data.pots[3].join('\n');

                // ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã‚’éè¡¨ç¤ºã€è¨­å®šç”»é¢ã‚’è¡¨ç¤º
                document.getElementById('loading').style.display = 'none';
                document.getElementById('setupSection').style.display = 'block';
                
                showNotification('ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸ', 'success');
            } catch (error) {
                console.error('Load error:', error);
                // data.jsonãŒç„¡ã„å ´åˆã¯ç©ºã®ãƒ•ã‚©ãƒ¼ãƒ ã‚’è¡¨ç¤º
                document.getElementById('loading').style.display = 'none';
                document.getElementById('setupSection').style.display = 'block';
                showNotification('data.jsonãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€‚æ–°è¦ä½œæˆã—ã¦ãã ã•ã„ã€‚', 'error');
            }
        }

        // data.jsonã®å†èª­ã¿è¾¼ã¿
        async function reloadData() {
            document.getElementById('loading').style.display = 'block';
            document.getElementById('setupSection').style.display = 'none';
            await loadData();
        }

        // data.jsonã®ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
        function exportDataJson() {
            // å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®å–å¾—
            const pot1Input = document.getElementById('pot1Input').value;
            const pot2Input = document.getElementById('pot2Input').value;
            const pot3Input = document.getElementById('pot3Input').value;

            // ç©ºè¡Œã‚’é™¤å¤–ã—ã¦é…åˆ—ã«å¤‰æ›
            const pot1Data = pot1Input.split('\n').filter(name => name.trim() !== '');
            const pot2Data = pot2Input.split('\n').filter(name => name.trim() !== '');
            const pot3Data = pot3Input.split('\n').filter(name => name.trim() !== '');

            // ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã®ä½œæˆ
            const exportData = {
                version: '1.0',
                lastUpdated: new Date().toISOString(),
                pots: {
                    1: pot1Data,
                    2: pot2Data,
                    3: pot3Data
                }
            };

            // JSONãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰
            const dataStr = JSON.stringify(exportData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'data.json';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);

            showNotification('data.jsonã‚’ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ã—ã¾ã—ãŸ!', 'success');
        }

        // æŠ½é¸é–‹å§‹
        function startLottery() {
            // å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ã¨å‡¦ç†
            const pot1Input = document.getElementById('pot1Input').value;
            const pot2Input = document.getElementById('pot2Input').value;
            const pot3Input = document.getElementById('pot3Input').value;

            // ç©ºè¡Œã‚’é™¤å¤–ã—ã¦é…åˆ—ã«å¤‰æ›
            potData[1] = pot1Input.split('\n').filter(name => name.trim() !== '');
            potData[2] = pot2Input.split('\n').filter(name => name.trim() !== '');
            potData[3] = pot3Input.split('\n').filter(name => name.trim() !== '');

            // æœ€ä½1ã¤ã®POTã«ãƒ‡ãƒ¼ã‚¿ãŒå¿…è¦
            if (potData[1].length === 0 && potData[2].length === 0 && potData[3].length === 0) {
                showNotification('å°‘ãªãã¨ã‚‚1ã¤ã®POTã«äººç‰©åã‚’å…¥åŠ›ã—ã¦ãã ã•ã„', 'error');
                return;
            }

            // ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹ã‚’ãƒªã‚»ãƒƒãƒˆ
            potIndex = { 1: 0, 2: 0, 3: 0 };
            history = [];
            teams = { 1: [], 2: [], 3: [] };
            drawOrder = 0;

            // ç”»é¢åˆ‡ã‚Šæ›¿ãˆ
            document.getElementById('setupSection').style.display = 'none';
            document.getElementById('lotterySection').classList.add('active');

            // ã‚«ã‚¦ãƒ³ãƒˆè¡¨ç¤ºã®æ›´æ–°
            updateAllCounts();
            updateAllButtons();
            updateAllTeams();
        }

        // æŠ½é¸å®Ÿè¡Œ
        function draw(potNumber) {
            const data = potData[potNumber];
            const currentIndex = potIndex[potNumber];

            if (currentIndex >= data.length) {
                return; // ã‚‚ã†å¼•ã‘ãªã„
            }

            // ç™»éŒ²é †ã«å–å¾—
            const selectedName = data[currentIndex];
            potIndex[potNumber]++;
            drawOrder++;

            // çµæœã‚’è¡¨ç¤º
            const resultElement = document.getElementById(`pot${potNumber}Result`);
            resultElement.textContent = selectedName;
            resultElement.classList.add('has-result');

            // ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ãƒªã‚»ãƒƒãƒˆã™ã‚‹ãŸã‚ä¸€åº¦ã‚¯ãƒ©ã‚¹ã‚’å‰Šé™¤ã—ã¦å†è¿½åŠ 
            setTimeout(() => {
                resultElement.classList.remove('has-result');
                void resultElement.offsetWidth; // reflow
                resultElement.classList.add('has-result');
            }, 10);

            // ãƒãƒ¼ãƒ ã«è¿½åŠ ï¼ˆPOTç•ªå·ã«å¯¾å¿œã™ã‚‹ãƒãƒ¼ãƒ ç•ªå·ã«è¿½åŠ ï¼‰
            teams[potNumber].push({
                name: selectedName,
                order: drawOrder
            });

            // å±¥æ­´ã«è¿½åŠ 
            const now = new Date();
            const timeString = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}:${now.getSeconds().toString().padStart(2, '0')}`;
            history.unshift({
                pot: potNumber,
                team: potNumber,
                name: selectedName,
                time: timeString
            });

            updateHistory();
            updateCount(potNumber);
            updateButton(potNumber);
            updateTeam(potNumber);
        }

        // ã‚«ã‚¦ãƒ³ãƒˆæ›´æ–°
        function updateCount(potNumber) {
            const remaining = potData[potNumber].length - potIndex[potNumber];
            document.getElementById(`pot${potNumber}Count`).textContent = `æ®‹ã‚Š: ${remaining}å`;
        }

        function updateAllCounts() {
            for (let i = 1; i <= 3; i++) {
                updateCount(i);
            }
        }

        // ãƒœã‚¿ãƒ³çŠ¶æ…‹æ›´æ–°
        function updateButton(potNumber) {
            const button = document.getElementById(`pot${potNumber}Button`);
            const remaining = potData[potNumber].length - potIndex[potNumber];
            
            if (remaining === 0) {
                button.disabled = true;
                button.textContent = 'çµ‚äº†';
            }
        }

        function updateAllButtons() {
            for (let i = 1; i <= 3; i++) {
                updateButton(i);
            }
        }

        // ãƒãƒ¼ãƒ è¡¨ç¤ºæ›´æ–°
        function updateTeam(teamNumber) {
            const teamMembers = teams[teamNumber];
            const teamMembersElement = document.getElementById(`team${teamNumber}Members`);
            const teamCountElement = document.getElementById(`team${teamNumber}Count`);

            // ã‚«ã‚¦ãƒ³ãƒˆæ›´æ–°
            teamCountElement.textContent = `${teamMembers.length}å`;

            // ãƒ¡ãƒ³ãƒãƒ¼è¡¨ç¤º
            if (teamMembers.length === 0) {
                teamMembersElement.innerHTML = '<div class="team-empty">ã¾ã ãƒ¡ãƒ³ãƒãƒ¼ãŒã„ã¾ã›ã‚“</div>';
            } else {
                teamMembersElement.innerHTML = teamMembers.map(member => `
                    <div class="team-member">
                        <span class="member-name">${member.name}</span>
                        <span class="member-order">#${member.order}</span>
                    </div>
                `).join('');
            }
        }

        function updateAllTeams() {
            for (let i = 1; i <= 3; i++) {
                updateTeam(i);
            }
        }

        // å±¥æ­´æ›´æ–°
        function updateHistory() {
            const historyList = document.getElementById('historyList');
            
            if (history.length === 0) {
                historyList.innerHTML = '<p style="text-align: center; color: #999;">ã¾ã æŠ½é¸ãŒè¡Œã‚ã‚Œã¦ã„ã¾ã›ã‚“</p>';
                return;
            }

            historyList.innerHTML = history.map(item => `
                <div class="history-item">
                    <span class="history-pot pot${item.pot}">POT ${item.pot}</span>
                    <span>${item.name} â†’ ãƒãƒ¼ãƒ ${item.team}</span>
                    <span style="color: #999; font-size: 12px;">${item.time}</span>
                </div>
            `).join('');
        }

        // ãƒªã‚»ãƒƒãƒˆ
        function resetLottery() {
            if (!confirm('ãƒªã‚»ãƒƒãƒˆã—ã¦ã‚ˆã‚ã—ã„ã§ã™ã‹?')) {
                return;
            }

            // è¨­å®šç”»é¢ã«æˆ»ã‚‹
            document.getElementById('setupSection').style.display = 'block';
            document.getElementById('lotterySection').classList.remove('active');

            // çµæœè¡¨ç¤ºã‚’ã‚¯ãƒªã‚¢
            for (let i = 1; i <= 3; i++) {
                document.getElementById(`pot${i}Result`).textContent = 'çµæœè¡¨ç¤º';
                document.getElementById(`pot${i}Result`).classList.remove('has-result');
                document.getElementById(`pot${i}Button`).disabled = false;
                document.getElementById(`pot${i}Button`).textContent = 'æŠ½é¸';
            }

            // ãƒãƒ¼ãƒ ã‚’ãƒªã‚»ãƒƒãƒˆ
            teams = { 1: [], 2: [], 3: [] };
            drawOrder = 0;
            updateAllTeams();
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ãƒ‡ãƒ¼ã‚¿ã‚’è‡ªå‹•èª­ã¿è¾¼ã¿
        window.addEventListener('load', loadData);
    </script>
</body>
</html>